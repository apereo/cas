<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

    <title>Service UI Fragment</title>
    <link href="../../static/css/cas.css" rel="stylesheet" th:remove="tag"/>
</head>

<body>
<main>
    <th:div th:fragment="switchbutton (id,label)">

        <script th:inline="javascript">
            window.switchButtonChangeHandler = function (el) {
                const attributes = $(el).data('attrs');
                if (attributes) {
                    const attrMap = {};
                    attributes.split(',').forEach(pair => {
                        const [key, value] = pair.split('=');
                        attrMap[key] = value;
                    });
                    const fnName = attrMap["changeEventHandler"];
                    if (fnName && typeof window[fnName] === "function") {
                        window[fnName](el);
                    }
                }
            };
        </script>
        <div th:id="${id + 'SwitchButtonPanel'}" th:classappend="${cssClass ?: ''}" style="display: none">
            <button th:id="${id + 'Button'}" th:name="${id + 'Button'}"
                    class="mdc-switch" th:title="${title ?: ''}"
                    th:classappend="${#cas.isTrue(selected) ? 'mdc-switch--selected class' : 'mdc-switch--unselected'}"
                    type="button" role="switch"
                    th:aria-checked="${#cas.isTrue(selected) ? 'true' : 'false'}">
                <div class="mdc-switch__track"></div>
                <div class="mdc-switch__handle-track">
                    <div class="mdc-switch__handle">
                        <div class="mdc-switch__shadow">
                            <div class="mdc-elevation-overlay"></div>
                        </div>
                        <div class="mdc-switch__ripple"></div>
                        <div class="mdc-switch__icons">
                            <svg class="mdc-switch__icon mdc-switch__icon--on" viewBox="0 0 24 24">
                                <path d="M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z" />
                            </svg>
                            <svg class="mdc-switch__icon mdc-switch__icon--off" viewBox="0 0 24 24">
                                <path d="M20 13H4v-2h16v2z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <span class="mdc-switch__focus-ring-wrapper">
                    <div class="mdc-switch__focus-ring"></div>
                </span>
            </button>
            <label class="form-check-label"
                   th:id="${id + 'ButtonLabel'}"
                   th:if="${#strings.startsWith(label, '#')}"
                   th:utext="${#strings.substring(label, 1)}">Switch Me</label>
            <label class="form-check-label"
                   th:id="${id + 'ButtonLabel'}"
                   th:if="${not #strings.startsWith(label, '#')}"
                   th:utext="#{${label}}">Switch Me</label>
            <input type="hidden" th:name="${id}" th:id="${id}"
                   th:data-attrs="${dataAttrs ?: ''}"
                   onchange="switchButtonChangeHandler(this)"
                   th:data-param-name="${id}" th:value="${#cas.isTrue(selected)}" th:data-switch-btn="${id + 'Button'}"/>
        </div>
        <div th:id="${id + 'checkBoxPanel'}" class="form-check form-switch"
             th:classappend="${cssClass ?: ''}"
             style="display: none">
            <input type="checkbox"
                   onchange="switchButtonChangeHandler(this)"
                   class="form-check-input" th:data-attrs="${dataAttrs ?: ''}" th:id="${id}" th:name="${id}" />
            <label class="form-check-label" th:for="${id}" th:id="${id + 'ButtonLabel'}" th:utext="#{${label}}">Switch Me</label>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            
            document.addEventListener('DOMContentLoaded', () => {
                if (typeof mdc === 'undefined' || mdc === undefined) {
                    $(/*[[${'#' + id + 'SwitchButtonPanel'}]]*/).hide().empty();
                    $(/*[[${'#' + id + 'checkBoxPanel'}]]*/).show();
                } else {
                    let cssClass = /*[[${cssClass}]]*/;
                    let button = /*[[${'#' + id + 'SwitchButtonPanel'}]]*/;
                    if (cssClass && cssClass.indexOf('hide') !== -1) {
                        $(button).hide();
                    } else {
                        $(button).show();
                    }
                    $(/*[[${'#' + id + 'checkBoxPanel'}]]*/).hide().empty();
                }
            });
            /*]]>*/
        </script>
    </th:div>
</main>
</body>

</html>
