<project
   xmlns:j="jelly:core"
   xmlns:ant="jelly:ant"
   xmlns:util="jelly:util"
   xmlns:maven="jelly:maven">

    <!-- =========== Set root dir =========== -->

    <j:set var="rootdir">${basedir}</j:set>

    <j:while test="${true}">
        <util:available file="${rootdir}/core/project.xml">
            <j:break/>
        </util:available>
        <j:set var="rootdir">${rootdir}/..</j:set>
    </j:while>

    <ant:dirname property="rootdirname" file="${rootdir}/project.xml"/>
    <j:set var="rootdir">${rootdirname}</j:set>
    <echo>Using root dir: ${rootdir}</echo>

	<preGoal name="site">
		<attainGoal name="statcvs" />
		<attainGoal name="xdoc" />
	</preGoal>

    <postGoal name="site">
        <attainGoal name="dashboard:report-single"/>
    </postGoal>

	<preGoal name="war:init">
		<attainGoal name="clean" />
		<attainGoal name="jar" />
		<j:set var="maven.test.skip">true</j:set>
	    <copy todir="${maven.build.dir}/${pom.artifactId}/WEB-INF/lib" file="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}.jar" />
	    <copy todir="${maven.build.dir}/${pom.artifactId}/WEB-INF/lib" file="${basedir}/lib/jmxremote_optional.jar" />
	    <copy todir="${maven.build.dir}/${pom.artifactId}/WEB-INF/lib" file="${basedir}/lib/jmxremote.jar" />
	</preGoal>
	
	<goal name="maven-multichanges-report:register">
		<attainGoal name="multichanges:report" />
	</goal>
</project>
