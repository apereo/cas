<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single sign-on, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

    







    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" />
    
    
    <link rel="stylesheet" type="text/css" media="screen" href='/cas/stylesheets/stylesheet.css'>
    <link rel="stylesheet" type="text/css" media="print" href='/cas/stylesheets/print.css'>

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Scripting with Apache Groovy</title>

</head>

<body>
    <!-- HEADER -->
    <header class="hidden-sm-down">
        <div class="container">
            <div class="row">
                <div class="col-xs-4 col-md-2">
                    <a href="../../index.html">
                        <img class="undecorated" src="/cas/images/cas_logo.png">
                    </a>
                </div>
                <div class="col-xs-8 col-md-6">
                    <h1>Enterprise Identity for All Earthlings and Beyond</h1>
<p><sub>Identity, Single Sign-On and Access Management</sub></p>
                </div>
                <div class="hidden-sm-down col-md-4">
                    <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
                </div>

            </div>
        </div>
    </header>

    <!-- NAVBAR -->

    <nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
        
        <button onclick="navigateSidebar()" id="sidebarNavButton">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        
        <div class="container">
<!--            <button id="navigationNavButton" class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"-->
<!--                    data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"-->
<!--                    aria-label="Toggle navigation">-->
<!--                <span class="navbar-toggler-icon"></span>-->
<!--            </button>-->

            <div class="navbar-collapse collapse" id="navbarsExample04">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                    <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                    <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                    <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                    <li class="nav-item dropdown">
                        <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Versions</a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                            
                            
                            <a class="dropdown-item" href="/cas/development/">Development</a>
                            
                            
                            
                            <a class="dropdown-item" href="/cas/7.1.x/">v7.1.x</a>
                            
                            
                            
                            <a class="dropdown-item" href="/cas/7.0.x/">v7.0.x</a>
                            
                            

                        </div>
                    </li>
                    <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
                </ul>

            </div>

        </div>
    </nav>


    <div class="container-fluid">
        <div class="row flex-xl-nowrap">

            
                <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>

                <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>

            

            <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">
                
                

                <section>
                    
                    <nav id="docsNavBar">
                        <span id="toolbarIcons"></span>
                    </nav>
                    

                    <div id="cas-docs-container">
                        
<h1 id="scripting-with-apache-groovy">Scripting with Apache Groovy</h1>

<p><a href="https://groovy-lang.org/">Apache Groovy</a> is a powerful, optionally typed and dynamic language, with static-typing and static compilation capabilities, 
for the Java platform aimed at improving developer productivity thanks to a concise, familiar and easy to learn syntax.</p>

<p>Support is enabled by including the following module in the WAR overlay:</p>

<script type="text/javascript">

    function tabClicked(element) {
        let radius = "0px 5px 5px 5px";
        let href = $(element).attr("href");
        if (!href.startsWith("#maven")) {
            radius = "5px 5px 5px 5px";
        }
        $(".tab-pane .highlight>pre.highlight").css("border-radius", radius);

        let label = $(element).text();

        function updateTab(targetId, idsToDeactivate) {
            $(`div #${targetId}orgapereocascasservercorescripting`).addClass("active").addClass("show");
            idsToDeactivate.forEach(id => $(`div #${id}orgapereocascasservercorescripting`).removeClass("active").removeClass("show"));
        }

        switch (label) {
        case "Apache Maven":
            updateTab("maven", ["gradle", "bom", "bomGradle"]);
            break;
        case "Gradle":
            updateTab("gradle", ["maven", "bom", "bomGradle"]);
            break;
        case "BOM - Spring":
            updateTab("bom", ["maven", "gradle", "bomGradle"]);
            break;
        case "BOM - Gradle":
            updateTab("bomGradle", ["maven", "bom", "gradle"]);
            break;
        }
    }

    window.onload = () => {
        $("ul.cas-modules li.cas-module a.nav-link.active").first().click();
    }
</script>
<div style="display: block">

    <ul class="nav nav-pills cas-modules">
        <li class="nav-item cas-module"><a class="nav-link" onclick="tabClicked(this)" data-bs-toggle="tab" href="#mavenorgapereocascasservercorescripting">Apache Maven</a></li>
        <li class="nav-item cas-module"><a class="nav-link" onclick="tabClicked(this)" data-bs-toggle="tab" href="#gradleorgapereocascasservercorescripting">Gradle</a></li>
<li class="nav-item cas-module"><a class="nav-link" onclick="tabClicked(this)" data-bs-toggle="tab" href="#bomorgapereocascasservercorescripting">BOM - Spring</a></li>

        <li class="nav-item cas-module">
            <a class="nav-link active" onclick="tabClicked(this)" data-bs-toggle="tab" href="#bomGradleorgapereocascasservercorescripting">BOM - Gradle</a>
        </li>
<li role="presentation" class="nav-item dropdown cas-module">
            <a class="nav-link dropdown-toggle" onclick="tabClicked(this)" data-bs-toggle="dropdown" href="#" role="button">Resources<span class="caret"></span>
            </a>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="javascript:showOverlay('cas-server-core-scripting',%20'cas-overlay');">Show in CAS Initializr</a>
                <a class="dropdown-item" href="javascript:generateOverlay('cas-server-core-scripting',%20'cas-overlay');">Generate CAS Server WAR Overlay</a>
                <a class="dropdown-item" href="javascript:generateOverlay('cas-server-core-scripting',%20'cas-config-server-overlay');">Generate CAS Configuration Server WAR Overlay</a>
            </div>
        </li>
    </ul>


    <div class="cas-module-tabs tab-content clearfix">
        <div class="tab-pane fade in" id="mavenorgapereocascasservercorescripting">
<span>
      <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-core-scripting<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

    </span>

        </div>


        <div class="tab-pane fade in active show" id="gradleorgapereocascasservercorescripting">

            <span>
    
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="n">implementation</span> <span class="s2">"org.apereo.cas:cas-server-core-scripting:${project.'cas.version'}"</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

  </span>

        </div>

        <div class="tab-pane fade in" id="bomorgapereocascasservercorescripting">
<span>
    <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="n">dependencyManagement</span> <span class="o">{</span>
    <span class="n">imports</span> <span class="o">{</span>
        <span class="n">mavenBom</span> <span class="s2">"org.apereo.cas:cas-server-support-bom:${project.'cas.version'}"</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s2">"org.apereo.cas:cas-server-core-scripting"</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

  </span>

        </div>

        <div class="tab-pane fade in" id="bomGradleorgapereocascasservercorescripting">
<span>
    <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td>
<td class="rouge-code"><pre><span class="n">dependencies</span> <span class="o">{</span>
    <span class="cm">/*
        The following platform references should be included automatically and are listed here for reference only.

        implementation enforcedPlatform("org.apereo.cas:cas-server-support-bom:${project.'cas.version'}")
        implementation platform(org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES)
        
    */</span>
    <span class="n">implementation</span> <span class="s2">"org.apereo.cas:cas-server-core-scripting"</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

  </span>

        </div>

    </div>

</div>

<div class="alert alert-info">
<img class="emoji" title=":information_source:" alt=":information_source:" src="https://github.githubassets.com/images/icons/emoji/unicode/2139.png" height="20" width="20"> <strong>Usage</strong><p>
Remember to include the above module in your CAS build if you intend to implement any sort of behavior with Apache Groovy and scripting.
This includes evaluating policies, release attributes, modifying or customizing components, etc. Without the listed above module,
Apache Groovy functionality and libraries will not be pulled into your CAS project and CAS would most likely fail to deliver at runtime.</p>
</div>

<p>CAS takes advantage of Apache Groovy in forms of either embedded or external scripts that allow one to, by default, 
dynamically build constructs, attributes, access strategies and a lot more.</p>

<p>As an example, the following construct is what’s referred to in CAS as an <em>embedded</em> or <em>inline</em> Groovy script:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.CasRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^https://example.app.org/login"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sample"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"allowedAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return ['casuser'] }"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td>
</tr></tbody></table></code></pre></div></div>

<p>By default, all such scripts are evaluated and executed <em>dynamically</em> using the Groovy meta object protocol. There is also support for the
alternative that allows CAS to tune the Groovy compiler for static compilation. In this mode, all methods, properties, files, 
inner classes, etc. found in scripts will be type checked. If you wish to always compile Groovy scripts using <code class="language-plaintext highlighter-rouge">CompileStatic</code>, 
you may specify the following <strong>system property</strong> when you run CAS:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nt">-Dorg</span>.apereo.cas.groovy.compile.static<span class="o">=</span><span class="nb">true</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>When CAS runs in <code class="language-plaintext highlighter-rouge">CompileStatic</code> mode, Groovy scripts most likely will need to be rewritten to remove all dynamic constructs.
For example, the following Groovy script is one that uses dynamic/meta aspects of the Groovy programming language:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="k">if</span> <span class="o">(</span><span class="n">attributes</span><span class="o">[</span><span class="s1">'entitlement'</span><span class="o">].</span><span class="na">contains</span><span class="o">(</span><span class="s1">'admin'</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">[</span><span class="n">attributes</span><span class="o">[</span><span class="s1">'uid'</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">toUpperCase</span><span class="o">()]</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">attributes</span><span class="o">[</span><span class="s1">'identifier'</span><span class="o">]</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>The same script in <code class="language-plaintext highlighter-rouge">CompileStatic</code> mode would be rewritten as:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="kt">def</span> <span class="n">attributes</span> <span class="o">=</span> <span class="o">(</span><span class="n">Map</span><span class="o">)</span> <span class="n">binding</span><span class="o">.</span><span class="na">getVariable</span><span class="o">(</span><span class="s1">'attributes'</span><span class="o">)</span>
<span class="k">if</span> <span class="o">((</span><span class="n">attributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s1">'entitlement'</span><span class="o">)</span> <span class="k">as</span> <span class="n">List</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s1">'admin'</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">[(</span><span class="n">attributes</span><span class="o">[</span><span class="s1">'uid'</span><span class="o">]</span> <span class="k">as</span> <span class="n">List</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">toString</span><span class="o">().</span><span class="na">toUpperCase</span><span class="o">()]</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">attributes</span><span class="o">[</span><span class="s1">'identifier'</span><span class="o">]</span> <span class="k">as</span> <span class="n">List</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

                    </div>
                </section>
            </main>
        </div>
    </div>


    <footer>
        <div class="container">
            CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
        </div>
    </footer>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/tether@2.0.0/dist/js/tether.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>

    <script src="/cas/javascripts/URI.js"></script>
    <script src="/cas/javascripts/main.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>

    <script>
        let pageSection = 'Installation';
        let siteUrl = '';
        let basePath = '/cas';

        
    </script>
</body>

</html>
