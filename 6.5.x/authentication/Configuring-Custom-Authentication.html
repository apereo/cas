<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="CAS - Enterprise Single Sign-On for the Web"/>
    <meta name="keywords" content="authentication, login, cas, central authentication service, web, java, protocol, thymeleaf,
                   open source, boot, spring, authorization, google, facebook, twitter, higher-ed, enterprise,
                   access management, single signon, sso, RBAC, ABAC, attributes, SAML, OpenID, openid connect,
                   JWT, ADFS"/>
    <meta name="robots" content="index,follow"/>

    
    

        
    


    

    <script>
        ((i, s, o, g, r, a, m) => {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-83384532-2', 'auto');
        ga('send', 'pageview');

    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="print" href="../../stylesheets/print.css">

    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">

    <title>CAS - Design Authentication Strategies</title>

</head>

<body>
<!-- HEADER -->
<header class="hidden-sm-down">
    <div class="container">
        <div class="row">
            <div class="col-xs-4 col-md-2">
                <a href="../../index.html">
                    <img class="undecorated" src="../../images/cas_logo.png"/>
                </a>
            </div>
            <div class="col-xs-8 col-md-6">
                <h1>Enterprise Single Sign-On for All</h1>
            </div>
            <div class="hidden-sm-down col-md-4">
                <a id="forkme_banner" href="https://github.com/apereo/cas">View on GitHub</a>
            </div>

        </div>
    </div>
</header>

<!-- NAVBAR -->

<nav class="navbar navbar-expand-md navbar-dark bg-primary bg-dark">
    <div class="container">
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarsExample04">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active"><a href="../../index.html" class="zoom nav-link">Home</a></li>
                <li class="nav-item"><a href="https://github.com/apereo/cas/releases" class="zoom nav-link">Releases</a></li>
                <li class="nav-item"><a href="../../Support.html" class="zoom nav-link">Support</a></li>
                <li class="nav-item"><a href="../../Mailing-Lists.html" class="zoom nav-link">Mailing Lists</a></li>
                <li class="nav-item">
                    <a class="zoom nav-link" href="../../Demos.html">Demos</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="zoom nav-link dropdown-toggle mr-md-2" href="#" id="cas-versions" data-bs-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Versions</a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="cas-versions">
                        
                        
                        <a class="dropdown-item" href="/cas/development/">Development</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.6.x/">v6.6.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.5.x/">v6.5.x</a>
                        
                        
                        
                        <a class="dropdown-item" href="/cas/6.4.x/">v6.4.x</a>
                        
                        

                    </div>
                </li>
                <li class="nav-item"><a href="https://apereo.github.io" target="_blank" class="zoom nav-link">Blog</a></li>
            </ul>

        </div>

    </div>
</nav>


<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 docs-sidebar pb-5" id="sidebar"></div>


        <div class="d-none d-xl-block col-xl-2 docs-toc">
    <div id="pageContents">
        <ul class="section-nav"></ul>
    </div>
</div>


        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 cas-docs-content" role="main">


            

            <section>
                <nav id="docsNavBar">
                    <span id="toolbarIcons"></span>
                </nav>

                <div id="cas-docs-container">
                    
<h1 id="custom-authentication-strategies">Custom Authentication Strategies</h1>

<p>While authentication support in CAS for a variety of systems is somewhat comprehensive and complex, a common deployment use case is the task of designing custom authentication schemes. This document describes the necessary steps needed to design and register a custom authentication strategy (i.e. <code class="language-plaintext highlighter-rouge">AuthenticationHandler</code>) in CAS.</p>

<p>This guide really is intended for developers with a basic-to-medium familiarity with Spring, Spring Boot and Spring Webflow. This is <em>NOT</em> a tutorial to be used verbatim via copy/paste. It is instead a recipe for developers to extend CAS based on specialized requirements.</p>

<h2 id="overview">Overview</h2>

<p>The overall tasks may be categorized as such:</p>

<ol>
  <li>Design the authentication handler.</li>
  <li>Register the authentication handler with the CAS authentication engine.</li>
  <li>Let CAS to recognize the authentication configuration.</li>
</ol>

<h2 id="design">Design</h2>

<p>First step is to define the skeleton for the authentication handler itself. This is the core principal component whose job is to declare support for a given type of credential only to then attempt to validate it and produce a successful result. The core parent component from which all handlers extend is the <code class="language-plaintext highlighter-rouge">AuthenticationHandler</code> interface.</p>

<p>With the assumption that the type of credentials used here deal with the traditional username and password, noted by the infamous <code class="language-plaintext highlighter-rouge">UsernamePasswordCredential</code> below, a more appropriate skeleton to define for a custom authentication handler may seem like the following example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.cas</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationHandler</span> <span class="kd">extends</span> <span class="nc">AbstractUsernamePasswordAuthenticationHandler</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kd">protected</span> <span class="nc">AuthenticationHandlerExecutionResult</span> <span class="nf">authenticateUsernamePasswordInternal</span><span class="o">(</span>
        <span class="kd">final</span> <span class="nc">UsernamePasswordCredential</span> <span class="n">credential</span><span class="o">,</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">originalPassword</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">everythingLooksGood</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">createHandlerResult</span><span class="o">(</span><span class="n">credential</span><span class="o">,</span>
                <span class="k">this</span><span class="o">.</span><span class="na">principalFactory</span><span class="o">.</span><span class="na">createPrincipal</span><span class="o">(</span><span class="n">username</span><span class="o">),</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">FailedLoginException</span><span class="o">(</span><span class="s">"Sorry, you are a failure!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="review">Review</h3>

<ul>
  <li>
    <p>Authentication handlers have the ability to produce a fully resolved principal along with attributes. If you have the ability to retrieve attributes from the same place as the original user/principal account store, the final <code class="language-plaintext highlighter-rouge">Principal</code> object that is resolved here must then be able to carry all those attributes and claims inside it at construction time.</p>
  </li>
  <li>
    <p>The last parameter, <code class="language-plaintext highlighter-rouge">null</code>, is effectively a collection of warnings that is eventually worked into the authentication chain and conditionally shown to the user. Examples of such warnings include password status nearing an expiration date, etc.</p>
  </li>
  <li>
    <p>Authentication handlers also have the ability to block authentication by throwing a number of specific exceptions. A more common exception to throw back is <code class="language-plaintext highlighter-rouge">FailedLoginException</code> to note authentication failure. Other specific exceptions may be thrown to indicate abnormalities with the account status itself, such as <code class="language-plaintext highlighter-rouge">AccountDisabledException</code>.</p>
  </li>
  <li>
    <p>Various other components such as <code class="language-plaintext highlighter-rouge">PrincipalNameTransformer</code>s, <code class="language-plaintext highlighter-rouge">PasswordEncoder</code>s and such may also be injected into our handler if need be, though these are skipped for now in this post for simplicity.</p>
  </li>
</ul>

<h2 id="register">Register</h2>

<p>Once the handler is designed, it needs to be registered with CAS and put into the authentication engine.
This is done via the magic of <code class="language-plaintext highlighter-rouge">@Configuration</code> classes that are picked up automatically at runtime, per your approval,
whose job is to understand how to dynamically modify the application context.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.example.cas</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"MyAuthenticationEventExecutionPlanConfiguration"</span><span class="o">,</span> <span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="nc">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationEventExecutionPlanConfiguration</span>
                    <span class="kd">implements</span> <span class="nc">AuthenticationEventExecutionPlanConfigurer</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">AuthenticationHandler</span> <span class="nf">myAuthenticationHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyAuthenticationHandler</span><span class="o">();</span>
        <span class="cm">/*
            Configure the handler by invoking various setter methods.
            Note that you also have full access to the collection of resolved CAS settings.
            Note that each authentication handler may optionally qualify for an 'order`
            as well as a unique name.
        */</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureAuthenticationExecutionPlan</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AuthenticationEventExecutionPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">feelingGoodOnAMondayMorning</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">plan</span><span class="o">.</span><span class="na">registerAuthenticationHandler</span><span class="o">(</span><span class="n">myAuthenticationHandler</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now that we have properly created and registered our handler with the CAS authentication machinery, we just need to ensure that CAS is able to pick up our special configuration. To do so, create a <code class="language-plaintext highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file and reference the configuration class in it as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="se">\
</span>    <span class="s">com.example.cas.MyAuthenticationEventExecutionPlanConfiguration</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To learn more about the registration strategy, <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/">please see this guide</a>.</p>

<p>At runtime, CAS will try to automatically detect all components and beans that advertise themselves as <code class="language-plaintext highlighter-rouge">AuthenticationEventExecutionPlanConfigurers</code>. Each detected component is then invoked to register its own authentication execution plan. The result of this operation at the end will produce a ready-made collection of authentication handlers that are ready to be invoked by CAS in the given order defined, if any.</p>

                </div>
            </section>
        </main>
    </div>
</div>


<footer>
    <div class="container">
        CAS is supported by the <a href="https://www.apereo.org/">Apereo Foundation</a>.
    </div>
</footer>

<script>
    let pageSection = 'Authentication';
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.2/js/tether.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>

<script src="../../javascripts/URI.js"></script>
<script src="../../javascripts/main.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
</body>

</html>
